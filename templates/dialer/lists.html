{% extends "base.html" %}

{% block title %}Arama Listeleri - {{ app_name }}{% endblock %}

{% block extra_css %}
<style>
.lists-page { padding: 1.5rem; }

/* Upload Panel */
.upload-panel {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 20px;
    margin-bottom: 2rem;
    overflow: hidden;
    color: white;
}

.upload-panel-header {
    padding: 1.25rem 1.5rem;
    background: rgba(255,255,255,0.05);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.upload-panel-header i {
    font-size: 1.5rem;
    color: #4CAF50;
}

.upload-panel-header h3 {
    margin: 0;
    font-size: 1.1rem;
}

.upload-panel-body {
    padding: 1.5rem;
}


/* Error Warning */
.error-warning {
    background: linear-gradient(135deg, #f44336, #D32F2F);
    padding: 0.75rem 1rem;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.error-warning:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
}

/* Upload Section */
.upload-section {
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 1.5rem;
}

.upload-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
}

.upload-section-header h4 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
}

.upload-section-header a {
    color: #2196F3;
    font-size: 0.9rem;
}

.file-upload-area {
    border: 2px dashed rgba(255,255,255,0.2);
    border-radius: 10px;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 1rem;
}

.file-upload-area:hover {
    border-color: #4CAF50;
    background: rgba(76, 175, 80, 0.1);
}

.file-upload-area input[type="file"] {
    display: none;
}

.file-upload-area i {
    font-size: 2.5rem;
    color: #4CAF50;
    margin-bottom: 0.5rem;
}

.file-upload-area p {
    margin: 0;
    color: rgba(255,255,255,0.7);
}

.file-formats {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.5);
    margin-bottom: 1rem;
}

.analyze-btn {
    width: 100%;
    padding: 1rem;
    background: linear-gradient(135deg, #4CAF50, #388E3C);
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: all 0.3s;
}

.analyze-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
}

/* Required Fields */
.required-fields {
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 1.5rem;
}

.required-fields-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
}

.required-fields-header h4 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
}

.fields-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
}

.field-group h5 {
    color: #f44336;
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.field-group.recognized h5 {
    color: #4CAF50;
}

.field-group ul {
    list-style: disc;
    margin: 0;
    padding-left: 1.25rem;
    color: rgba(255,255,255,0.8);
    font-size: 0.85rem;
}

.field-group ul li {
    margin-bottom: 0.25rem;
}

.recognized-columns {
    color: rgba(255,255,255,0.6);
    font-size: 0.8rem;
}

/* Statistics Panel */
.stats-panel {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    margin-bottom: 1.5rem;
    overflow: hidden;
}

.stats-panel-header {
    padding: 1rem 1.5rem;
    background: linear-gradient(135deg, #9C27B0, #7B1FA2);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.stats-panel-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 700;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 0;
}

.stat-item {
    padding: 1.25rem;
    text-align: center;
    border-right: 1px solid #eee;
    border-bottom: 1px solid #eee;
}

.stat-item:last-child {
    border-right: none;
}

.stat-item-value {
    font-size: 1.5rem;
    font-weight: 800;
    margin-bottom: 0.25rem;
}

.stat-item-value.total { color: #9C27B0; }
.stat-item-value.valid { color: #4CAF50; }
.stat-item-value.duplicate { color: #FF9800; }
.stat-item-value.blacklist { color: #f44336; }
.stat-item-value.nointerest { color: #607D8B; }
.stat-item-value.error { color: #E91E63; }

.stat-item-label {
    font-size: 0.75rem;
    color: #888;
}

/* Customer Status Stats */
.customer-stats-panel {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    margin-bottom: 1.5rem;
}

.customer-stats-header {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.customer-stats-header h3 {
    margin: 0;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.customer-stats-body {
    padding: 1.5rem;
}

.status-stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
}

.status-stat {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 1rem;
    text-align: center;
}

.status-stat-value {
    font-size: 1.75rem;
    font-weight: 800;
}

.status-stat-label {
    font-size: 0.75rem;
    color: #888;
    margin-top: 0.25rem;
}

.status-stat-bar {
    height: 4px;
    background: #e0e0e0;
    border-radius: 2px;
    margin-top: 0.75rem;
    overflow: hidden;
}

.status-stat-bar-fill {
    height: 100%;
    border-radius: 2px;
}

/* Lists Table */
.lists-table-panel {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    overflow: hidden;
}

.lists-table-header {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.lists-table-header h3 {
    margin: 0;
    font-size: 1rem;
}

.lists-table {
    width: 100%;
    border-collapse: collapse;
}

.lists-table th,
.lists-table td {
    padding: 1rem 1.5rem;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.lists-table th {
    background: #f8f9fa;
    font-weight: 600;
    font-size: 0.8rem;
    color: #666;
    text-transform: uppercase;
}

.lists-table tr:hover {
    background: #f8f9fa;
}

.list-name {
    font-weight: 600;
}

.list-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
}

.list-badge.active { background: #E8F5E9; color: #2E7D32; }
.list-badge.processing { background: #FFF3E0; color: #E65100; }
.list-badge.completed { background: #E3F2FD; color: #1565C0; }

/* Selected File Display */
.selected-file {
    display: none;
    background: rgba(76, 175, 80, 0.1);
    border: 2px solid #4CAF50;
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.selected-file.show {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.selected-file-icon {
    width: 48px;
    height: 48px;
    background: #4CAF50;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
}

.selected-file-info {
    flex: 1;
}

.selected-file-name {
    font-weight: 600;
    color: white;
}

.selected-file-size {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.6);
}

.selected-file-remove {
    background: transparent;
    border: none;
    color: #f44336;
    cursor: pointer;
    font-size: 1.25rem;
}

/* Upload Settings */
.upload-settings {
    margin-bottom: 1.5rem;
}

.settings-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
}

.setting-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.setting-item.full-width {
    grid-column: 1 / -1;
}

.setting-item label {
    font-size: 0.85rem;
    font-weight: 600;
    color: rgba(255,255,255,0.9);
}

.setting-item small {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.5);
}

.form-input,
.form-select {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    color: white;
    font-size: 0.9rem;
    transition: all 0.2s;
}

.form-input:focus,
.form-select:focus {
    outline: none;
    border-color: #4CAF50;
    background: rgba(255,255,255,0.12);
}

.form-input::placeholder {
    color: rgba(255,255,255,0.4);
}

.form-select option {
    background: #1a1a2e;
    color: white;
}

.cc-info-badge {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: rgba(76, 175, 80, 0.15);
    border: 1px solid rgba(76, 175, 80, 0.3);
    border-radius: 10px;
    padding: 0.85rem 1rem;
    margin-top: 1rem;
}

.cc-info-badge i {
    font-size: 1.25rem;
    color: #4CAF50;
}

.cc-info-badge span {
    font-size: 0.85rem;
    color: rgba(255,255,255,0.8);
}
</style>
{% endblock %}

{% block content %}
<div class="lists-page">
    <div class="page-header">
        <div>
            <h1 class="page-title">
                <i class="ti ti-database" style="color: #9C27B0;"></i>
                <span data-tr="Arama Listeleri" data-de="Anruflisten">Arama Listeleri</span>
            </h1>
            <p class="page-subtitle" data-tr="Lead ve arama listelerini yönetin, data yükleyin" data-de="Verwalten Sie Lead- und Anruflisten, laden Sie Daten hoch">Lead ve arama listelerini yönetin, data yükleyin</p>
        </div>
    </div>

    <!-- Upload Statistics (shows after upload) -->
    <div class="stats-panel" id="uploadStats" style="display: none;">
        <div class="stats-panel-header">
            <div class="stats-panel-title">
                <i class="ti ti-chart-bar"></i>
                <span data-tr="Yükleme İstatistikleri" data-de="Upload-Statistiken">Yükleme İstatistikleri</span>
            </div>
            <span style="background: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem;">
                <span data-tr="Son yükleme:" data-de="Letzter Upload:">Son yükleme:</span> <span id="lastUploadTime">-</span>
            </span>
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-item-value total" id="statTotal">0</div>
                <div class="stat-item-label" data-tr="Toplam Kayıt" data-de="Gesamt">Toplam Kayıt</div>
            </div>
            <div class="stat-item">
                <div class="stat-item-value valid" id="statValid">0</div>
                <div class="stat-item-label" data-tr="Yüklendi ✓" data-de="Importiert ✓">Yüklendi ✓</div>
            </div>
            <div class="stat-item">
                <div class="stat-item-value duplicate" id="statDuplicate">0</div>
                <div class="stat-item-label" data-tr="Dublet" data-de="Duplikate">Dublet</div>
            </div>
            <div class="stat-item">
                <div class="stat-item-value blacklist" id="statBlacklist">0</div>
                <div class="stat-item-label" data-tr="Blacklist" data-de="Blacklist">Blacklist</div>
            </div>
            <div class="stat-item">
                <div class="stat-item-value nointerest" id="statNoInterest" style="color: #2196F3;">0</div>
                <div class="stat-item-label" data-tr="IBAN'lı" data-de="Mit IBAN">IBAN'lı</div>
            </div>
            <div class="stat-item">
                <div class="stat-item-value error" id="statError">0</div>
                <div class="stat-item-label" data-tr="Hatalı" data-de="Fehlerhaft">Hatalı</div>
            </div>
        </div>
    </div>

    <!-- Customer Status Statistics -->
    <div class="customer-stats-panel" id="customerStats" style="display: none;">
        <div class="customer-stats-header">
            <h3>
                <i class="ti ti-users" style="color: #9C27B0;"></i>
                <span data-tr="Müşteri Durum İstatistikleri" data-de="Kundenstatusstatistiken">Müşteri Durum İstatistikleri</span>
            </h3>
            <button class="btn btn-sm btn-secondary" onclick="downloadDetailedStats()">
                <i class="ti ti-download"></i> <span data-tr="Detaylı Rapor" data-de="Detaillierter Bericht">Detaylı Rapor</span>
            </button>
        </div>
        <div class="customer-stats-body">
            <div class="status-stats-grid">
                <div class="status-stat">
                    <div class="status-stat-value" style="color: #f44336;">500</div>
                    <div class="status-stat-label">Keine Interesse</div>
                    <div class="status-stat-bar">
                        <div class="status-stat-bar-fill" style="width: 35%; background: #f44336;"></div>
                    </div>
                </div>
                <div class="status-stat">
                    <div class="status-stat-value" style="color: #FF9800;">320</div>
                    <div class="status-stat-label">Termin</div>
                    <div class="status-stat-bar">
                        <div class="status-stat-bar-fill" style="width: 22%; background: #FF9800;"></div>
                    </div>
                </div>
                <div class="status-stat">
                    <div class="status-stat-value" style="color: #4CAF50;">280</div>
                    <div class="status-stat-label">Verkauft</div>
                    <div class="status-stat-bar">
                        <div class="status-stat-bar-fill" style="width: 20%; background: #4CAF50;"></div>
                    </div>
                </div>
                <div class="status-stat">
                    <div class="status-stat-value" style="color: #2196F3;">180</div>
                    <div class="status-stat-label">Rückruf</div>
                    <div class="status-stat-bar">
                        <div class="status-stat-bar-fill" style="width: 13%; background: #2196F3;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Intelligent Upload Panel -->
    <div class="upload-panel">
        <div class="upload-panel-header">
            <i class="ti ti-database-import"></i>
            <h3 data-tr="Veri Yükleme Merkezi" data-de="Datenupload-Zentrum">Veri Yükleme Merkezi</h3>
        </div>
        <div class="upload-panel-body">
            <!-- Data Name & Settings -->
            <div class="upload-settings">
                <div class="settings-row">
                    <div class="setting-item full-width">
                        <label data-tr="Veri Adı *" data-de="Datenname *">Veri Adı *</label>
                        <input type="text" id="dataName" class="form-input" placeholder="Örn: Ocak 2025 - Berlin Data" data-tr-placeholder="Örn: Ocak 2025 - Berlin Data" data-de-placeholder="z.B. Januar 2025 - Berlin Daten">
                        <small data-tr="Bu isim agent ekranında ve raporlarda görünecektir" data-de="Dieser Name wird im Agent-Bildschirm und in Berichten angezeigt">Bu isim agent ekranında ve raporlarda görünecektir</small>
                    </div>
                </div>
                
                <div class="settings-row">
                    <div class="setting-item">
                        <label data-tr="Kampanya Atama" data-de="Kampagnenzuweisung">Kampanya Atama</label>
                        <select id="campaignSelect" class="form-select">
                            <option value="" data-tr="Kampanya Seçin..." data-de="Kampagne auswählen...">Kampanya Seçin...</option>
                            <option value="1" data-tr="Outbound Satış" data-de="Outbound-Vertrieb">Outbound Satış</option>
                            <option value="2" data-tr="Satış Müşterileri" data-de="Vertriebskunden">Satış Müşterileri</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label data-tr="Dublet Eşleştirme" data-de="Duplikat-Abgleich">Dublet Eşleştirme</label>
                        <select id="duplicateCheck" class="form-select">
                            <option value="own" data-tr="Sadece Kendi Verim" data-de="Nur eigene Daten">Sadece Kendi Verim</option>
                            <option value="all" data-tr="Tüm Sistem Verisi" data-de="Alle Systemdaten">Tüm Sistem Verisi</option>
                            <option value="none" data-tr="Eşleştirme Yapma" data-de="Keine Überprüfung">Eşleştirme Yapma</option>
                        </select>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="setting-item">
                        <label data-tr="Blacklist Kontrolü" data-de="Blacklist-Prüfung">Blacklist Kontrolü</label>
                        <select id="blacklistCheck" class="form-select">
                            <option value="own" data-tr="Kendi Blacklist'im" data-de="Eigene Blacklist">Kendi Blacklist'im</option>
                            <option value="all" data-tr="Tüm Sistem Blacklist" data-de="System-Blacklist">Tüm Sistem Blacklist</option>
                            <option value="none" data-tr="Kontrol Etme" data-de="Nicht prüfen">Kontrol Etme</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label data-tr="Öncelik" data-de="Priorität">Öncelik</label>
                        <select id="prioritySelect" class="form-select">
                            <option value="high" data-tr="Yüksek" data-de="Hoch">Yüksek</option>
                            <option value="normal" selected data-tr="Normal" data-de="Normal">Normal</option>
                            <option value="low" data-tr="Düşük" data-de="Niedrig">Düşük</option>
                        </select>
                    </div>
                </div>

                <!-- CC Info Badge -->
                <div class="cc-info-badge">
                    <i class="ti ti-building"></i>
                    <span data-tr="Bu veri sadece kendi Call Center'ınıza ait olacak ve diğer CC'lerle paylaşılmayacaktır." data-de="Diese Daten gehören nur zu Ihrem Call Center und werden nicht mit anderen CCs geteilt.">Bu veri sadece kendi Call Center'ınıza ait olacak ve diğer CC'lerle paylaşılmayacaktır.</span>
                </div>
            </div>

            <div class="error-warning" onclick="downloadErrorReport()" id="errorWarning" style="display: none;">
                <i class="ti ti-alert-triangle"></i>
                <span data-tr="Hatalı Veriler import EDİLMEYECEK - Düzeltmek için İndir" data-de="Fehlerhafte Daten werden NICHT importiert - Download zum Korrigieren">Hatalı Veriler import EDİLMEYECEK - Düzeltmek için İndir</span>
            </div>

            <!-- File Upload Section -->
            <div class="upload-section">
                <div class="upload-section-header">
                    <h4>
                        <i class="ti ti-upload"></i>
                        <span data-tr="Dosya Yükle" data-de="Datei hochladen">Dosya Yükle</span>
                    </h4>
                    <a href="#" onclick="downloadTemplate()" data-tr="Şablon İndir" data-de="Vorlage herunterladen">Şablon İndir</a>
                </div>

                <div class="selected-file" id="selectedFile">
                    <div class="selected-file-icon"><i class="ti ti-file-spreadsheet"></i></div>
                    <div class="selected-file-info">
                        <div class="selected-file-name" id="fileName">-</div>
                        <div class="selected-file-size" id="fileSize">-</div>
                    </div>
                    <button class="selected-file-remove" onclick="removeFile()"><i class="ti ti-x"></i></button>
                </div>

                <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" onchange="handleFileSelect(event)">
                    <i class="ti ti-cloud-upload"></i>
                    <p data-tr="Excel/CSV Dosyası seçin veya sürükleyip bırakın" data-de="Excel/CSV Datei auswählen oder hierher ziehen">Excel/CSV Dosyası seçin veya sürükleyip bırakın</p>
                </div>

                <div class="file-formats" data-tr="Desteklenen formatlar: .xlsx, .xls, .csv" data-de="Unterstützte Formate: .xlsx, .xls, .csv">Desteklenen formatlar: .xlsx, .xls, .csv</div>

                <button class="analyze-btn" onclick="analyzeAndImport()">
                    <i class="ti ti-database-import"></i>
                    <span data-tr="Analiz Et & İçe Aktar" data-de="Analysieren & Importieren">Analiz Et & İçe Aktar</span>
                </button>
            </div>

            <!-- Required Fields -->
            <div class="required-fields">
                <div class="required-fields-header">
                    <h4>
                        <i class="ti ti-check" style="color: #4CAF50;"></i>
                        <span data-tr="Alan Kontrolleri" data-de="Feldprüfungen">Alan Kontrolleri</span>
                    </h4>
                </div>

                <div class="fields-grid">
                    <div class="field-group">
                        <h5><i class="ti ti-x"></i> <span data-tr="Zorunlu (Bunlar Yoksa = Reddedilir)" data-de="Pflicht (Ohne diese = Abgelehnt)">Zorunlu (Bunlar Yoksa = Reddedilir)</span></h5>
                        <ul>
                            <li><strong>Telefon</strong> <span data-tr="(49 ile başlamalı)" data-de="(muss mit 49 beginnen)">(49 ile başlamalı)</span></li>
                            <li><strong>Vorname</strong> & <strong>Nachname</strong></li>
                            <li><strong>PLZ</strong>, <strong>Ort</strong>, <strong>Straße</strong></li>
                        </ul>
                    </div>
                    <div class="field-group recognized">
                        <h5><i class="ti ti-check"></i> <span data-tr="Opsiyonel (Varsa alınır)" data-de="Optional (falls vorhanden)">Opsiyonel (Varsa alınır)</span></h5>
                        <ul style="list-style: none; padding-left: 0;">
                            <li style="color: #4CAF50; margin-bottom: 0.5rem;">✓ IBAN, BIC <span style="color: rgba(255,255,255,0.5);">(opsiyonel)</span></li>
                            <li style="color: #4CAF50; margin-bottom: 0.5rem;">✓ BLZ, Konto <span style="color: rgba(255,255,255,0.5);">(opsiyonel)</span></li>
                            <li style="color: #4CAF50; margin-bottom: 0.5rem;">✓ Email <span style="color: rgba(255,255,255,0.5);">(opsiyonel)</span></li>
                            <li style="color: #4CAF50;">✓ Geburtsdatum <span style="color: rgba(255,255,255,0.5);">(opsiyonel)</span></li>
                        </ul>
                        <div class="recognized-columns" style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(255,255,255,0.1);">
                            <small data-tr="Tanınan sütun isimleri:" data-de="Erkannte Spaltennamen:">Tanınan sütun isimleri:</small>
                            <p style="font-size: 0.75rem;">Telefon, Tel, Phone, Handy, Vorname, Name, Nachname, PLZ, Ort, Strasse, Nr, IBAN, BIC, BLZ, Konto, Email, Geburtsdatum</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lists Table -->
    <div class="lists-table-panel">
        <div class="lists-table-header">
            <h3>
                <i class="ti ti-list" style="color: #9C27B0;"></i>
                <span data-tr="Yüklenen Listeler" data-de="Hochgeladene Listen">Yüklenen Listeler</span>
            </h3>
            <span class="text-muted">{{ lists|length if lists else 0 }} <span data-tr="liste" data-de="Listen">liste</span></span>
        </div>
        <table class="lists-table">
            <thead>
                <tr>
                    <th data-tr="Liste Adı" data-de="Listenname">Liste Adı</th>
                    <th data-tr="Kampanya" data-de="Kampagne">Kampanya</th>
                    <th data-tr="Toplam" data-de="Gesamt">Toplam</th>
                    <th data-tr="Geçerli" data-de="Gültig">Geçerli</th>
                    <th data-tr="Dublet" data-de="Duplikate">Dublet</th>
                    <th data-tr="Blacklist" data-de="Blacklist">Blacklist</th>
                    <th data-tr="Durum" data-de="Status">Durum</th>
                    <th data-tr="İşlemler" data-de="Aktionen">İşlemler</th>
                </tr>
            </thead>
            <tbody>
                {% for list in lists %}
                <tr>
                    <td class="list-name">{{ list.name }}</td>
                    <td>{{ list.campaign.name if list.campaign else '-' }}</td>
                    <td><strong>{{ list.total_records }}</strong></td>
                    <td style="color: #4CAF50;">{{ list.valid_records }}</td>
                    <td style="color: #FF9800;">{{ list.duplicate_records }}</td>
                    <td style="color: #f44336;">{{ list.blacklist_records or 0 }}</td>
                    <td>
                        <span class="list-badge {{ list.status }}">
                            {{ list.status|capitalize }}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-ghost" title="Detay" onclick="viewListDetail({{ list.id }})">
                            <i class="ti ti-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-ghost" title="İndir" onclick="downloadList({{ list.id }})">
                            <i class="ti ti-download"></i>
                        </button>
                        <button class="btn btn-sm btn-ghost text-danger" title="Sil" onclick="deleteList({{ list.id }})">
                            <i class="ti ti-trash"></i>
                        </button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" class="text-muted text-center" style="padding: 3rem;" data-tr="Henüz liste yüklenmemiş. Yukarıdan dosya yükleyin." data-de="Noch keine Liste hochgeladen. Laden Sie eine Datei oben hoch.">Henüz liste yüklenmemiş. Yukarıdan dosya yükleyin.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let selectedFile = null;

// Handle file selection
function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) {
        selectedFile = file;
        document.getElementById('selectedFile').classList.add('show');
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileSize').textContent = formatFileSize(file.size);
    }
}

// Format file size
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Remove selected file
function removeFile() {
    selectedFile = null;
    document.getElementById('selectedFile').classList.remove('show');
    document.getElementById('fileInput').value = '';
}

// Analyze and Import
function analyzeAndImport() {
    const dataName = document.getElementById('dataName').value.trim();
    const duplicateCheck = document.getElementById('duplicateCheck').value;
    const blacklistCheck = document.getElementById('blacklistCheck').value;
    const campaignId = document.getElementById('campaignSelect').value;
    const priority = document.getElementById('prioritySelect').value;

    // Validation
    if (!dataName) {
        alert(document.documentElement.lang === 'de' 
            ? 'Bitte geben Sie einen Datennamen ein' 
            : 'Lütfen veri adı girin');
        document.getElementById('dataName').focus();
        return;
    }

    if (!selectedFile) {
        alert(document.documentElement.lang === 'de' 
            ? 'Bitte wählen Sie zuerst eine Datei aus' 
            : 'Lütfen önce bir dosya seçin');
        return;
    }

    // Show loading
    const btn = document.querySelector('.analyze-btn');
    btn.innerHTML = '<i class="ti ti-loader"></i> ' + 
        (document.documentElement.lang === 'de' ? 'Wird analysiert...' : 'Analiz ediliyor...');
    btn.disabled = true;

    // Prepare upload data
    const uploadData = {
        name: dataName,
        file: selectedFile.name,
        duplicateCheck: duplicateCheck,
        blacklistCheck: blacklistCheck,
        campaignId: campaignId,
        priority: priority
    };

    console.log('Upload settings:', uploadData);

    // Simulate analysis (replace with actual API call)
    setTimeout(() => {
        // Show statistics
        document.getElementById('uploadStats').style.display = 'block';
        document.getElementById('customerStats').style.display = 'none'; // İlk yüklemede müşteri istatistiği yok
        
        // Dublet hesapla (sistemde data yoksa 0)
        let dupCount = 0;
        if (duplicateCheck === 'own') {
            dupCount = 0; // İlk yüklemede kendi verimde dublet yok
        } else if (duplicateCheck === 'all') {
            dupCount = 0; // Sistemde başka data yoksa dublet yok
        }
        
        // Blacklist hesapla
        let blacklistCount = 0;
        if (blacklistCheck !== 'none') {
            blacklistCount = 0; // Blacklist boşsa 0
        }
        
        // Sadece gerçek hatalar (zorunlu alan eksik: telefon, ad, adres)
        const errorCount = 12; // Sadece zorunlu alan eksik olanlar
        
        // Toplam kayıt
        const totalRecords = 1450;
        
        // Geçerli = Toplam - Dublet - Blacklist - Hatalı
        // IBAN/BLZ/Konto kontrolü YOK - hepsi geçerli
        const validCount = totalRecords - dupCount - blacklistCount - errorCount;
        
        // Conditionally show error warning
        if (errorCount > 0) {
            document.getElementById('errorWarning').style.display = 'flex';
        } else {
            document.getElementById('errorWarning').style.display = 'none';
        }

        // Banka bilgisi dağılımı (IBAN'lı olanlar)
        const ibanCount = Math.floor(validCount * 0.68); // ~%68 IBAN'lı
        
        // Set stats
        document.getElementById('statTotal').textContent = totalRecords.toLocaleString();
        document.getElementById('statValid').textContent = validCount.toLocaleString();
        document.getElementById('statDuplicate').textContent = dupCount.toString();
        document.getElementById('statBlacklist').textContent = blacklistCount.toString();
        document.getElementById('statNoInterest').textContent = ibanCount.toLocaleString(); // IBAN'lı sayısı
        document.getElementById('statError').textContent = errorCount.toString();
        document.getElementById('lastUploadTime').textContent = new Date().toLocaleTimeString('tr-TR');

        // Reset button
        btn.innerHTML = '<i class="ti ti-database-import"></i> ' + 
            (document.documentElement.lang === 'de' ? 'Analysieren & Importieren' : 'Analiz Et & İçe Aktar');
        btn.disabled = false;

        // Scroll to stats
        document.getElementById('uploadStats').scrollIntoView({ behavior: 'smooth' });

        const msg = document.documentElement.lang === 'de' 
            ? `Import abgeschlossen! "${dataName}" - ${validCount} Datensätze erfolgreich importiert.\n\n✅ Mit IBAN: 980\n✅ Mit BLZ/Konto: 320\n✅ Ohne Bankdaten: 138\n❌ Fehlerhaft (fehlende Pflichtfelder): ${errorCount}`
            : `İçe aktarma tamamlandı! "${dataName}" - ${validCount} kayıt başarıyla yüklendi.\n\n✅ IBAN'lı: 980\n✅ BLZ/Konto'lu: 320\n✅ Banka bilgisi olmayan: 138\n❌ Hatalı (zorunlu alan eksik): ${errorCount}`;
        alert(msg);

    }, 2000);
}

// Download error report
function downloadErrorReport() {
    alert(document.documentElement.lang === 'de' 
        ? 'Fehlerbericht wird heruntergeladen...' 
        : 'Hata raporu indiriliyor...');
}

// Download template
function downloadTemplate() {
    alert(document.documentElement.lang === 'de' 
        ? 'Vorlage wird heruntergeladen...' 
        : 'Şablon indiriliyor...');
}

// Download detailed stats
function downloadDetailedStats() {
    alert(document.documentElement.lang === 'de' 
        ? 'Detaillierter Bericht wird heruntergeladen...' 
        : 'Detaylı rapor indiriliyor...');
}

// View list detail
function viewListDetail(id) {
    alert('Liste #' + id + ' detayları');
}

// Download list
function downloadList(id) {
    alert('Liste #' + id + ' indiriliyor...');
}

// Delete list
function deleteList(id) {
    const msg = document.documentElement.lang === 'de' 
        ? 'Diese Liste wirklich löschen?' 
        : 'Bu listeyi silmek istediğinize emin misiniz?';
    
    if (confirm(msg)) {
        alert(document.documentElement.lang === 'de' ? 'Liste gelöscht' : 'Liste silindi');
        location.reload();
    }
}

// Drag and drop support
const uploadArea = document.querySelector('.file-upload-area');

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = '#4CAF50';
    uploadArea.style.background = 'rgba(76, 175, 80, 0.1)';
});

uploadArea.addEventListener('dragleave', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = 'rgba(255,255,255,0.2)';
    uploadArea.style.background = 'transparent';
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = 'rgba(255,255,255,0.2)';
    uploadArea.style.background = 'transparent';
    
    const file = e.dataTransfer.files[0];
    if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls') || file.name.endsWith('.csv'))) {
        selectedFile = file;
        document.getElementById('selectedFile').classList.add('show');
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileSize').textContent = formatFileSize(file.size);
    } else {
        alert(document.documentElement.lang === 'de' 
            ? 'Nur .xlsx, .xls oder .csv Dateien werden unterstützt' 
            : 'Sadece .xlsx, .xls veya .csv dosyaları desteklenir');
    }
});
</script>
{% endblock %}
