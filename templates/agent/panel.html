{% extends "base.html" %}

{% block title %}Agent Panel - {{ app_name }}{% endblock %}

{% block extra_css %}
<style>
/* Agent Panel Specific Styles */
.agent-panel {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 1.25rem;
    height: calc(100vh - 120px);
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%);
    padding: 1rem;
    border-radius: var(--border-radius-lg);
}

/* 3D İkon Stilleri */
.icon-3d {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 42px;
    height: 42px;
    border-radius: 12px;
    font-size: 1.25rem;
    position: relative;
    transform-style: preserve-3d;
    transition: all 0.3s ease;
}

.icon-3d::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: inherit;
    transform: translateZ(-8px);
    filter: brightness(0.7);
}

.icon-3d:hover {
    transform: translateY(-3px) rotateX(10deg);
}

.icon-3d.blue {
    background: linear-gradient(145deg, #64B5F6, #1E88E5);
    color: white;
    box-shadow: 0 6px 20px rgba(30, 136, 229, 0.4), 
                0 3px 6px rgba(30, 136, 229, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
}

.icon-3d.green {
    background: linear-gradient(145deg, #81C784, #43A047);
    color: white;
    box-shadow: 0 6px 20px rgba(67, 160, 71, 0.4),
                0 3px 6px rgba(67, 160, 71, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
}

.icon-3d.orange {
    background: linear-gradient(145deg, #FFB74D, #F57C00);
    color: white;
    box-shadow: 0 6px 20px rgba(245, 124, 0, 0.4),
                0 3px 6px rgba(245, 124, 0, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
}

.icon-3d.red {
    background: linear-gradient(145deg, #E57373, #E53935);
    color: white;
    box-shadow: 0 6px 20px rgba(229, 57, 53, 0.4),
                0 3px 6px rgba(229, 57, 53, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
}

.icon-3d.cyan {
    background: linear-gradient(145deg, #4DD0E1, #00ACC1);
    color: white;
    box-shadow: 0 6px 20px rgba(0, 172, 193, 0.4),
                0 3px 6px rgba(0, 172, 193, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
}

.icon-3d.purple {
    background: linear-gradient(145deg, #BA68C8, #8E24AA);
    color: white;
    box-shadow: 0 6px 20px rgba(142, 36, 170, 0.4),
                0 3px 6px rgba(142, 36, 170, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
}

.icon-3d.gold {
    background: linear-gradient(145deg, #FFD54F, #F9A825);
    color: #5D4037;
    box-shadow: 0 6px 20px rgba(249, 168, 37, 0.4),
                0 3px 6px rgba(249, 168, 37, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.4);
}

/* Left Sidebar - Call Controls */
.agent-sidebar {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

/* Status Badge - Premium Tasarım */
.agent-status-badge {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    background: linear-gradient(145deg, #ffffff, #f5f7fa);
    border: 1px solid rgba(0, 0, 0, 0.06);
    border-radius: var(--border-radius-lg);
    border-left: 5px solid #4CAF50;
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.15),
                0 2px 8px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 1);
    transition: all 0.3s ease;
}

.agent-status-badge:hover {
    transform: translateX(4px);
}

.agent-status-badge.busy { 
    border-left-color: #E53935;
    box-shadow: 0 8px 25px rgba(229, 57, 53, 0.15),
                0 2px 8px rgba(0, 0, 0, 0.04);
}
.agent-status-badge.pause { 
    border-left-color: #FFB300;
    box-shadow: 0 8px 25px rgba(255, 179, 0, 0.15),
                0 2px 8px rgba(0, 0, 0, 0.04);
}
.agent-status-badge.acw { 
    border-left-color: #42A5F5;
    box-shadow: 0 8px 25px rgba(66, 165, 245, 0.15),
                0 2px 8px rgba(0, 0, 0, 0.04);
}
.agent-status-badge.waiting { 
    border-left-color: #F5A623;
    box-shadow: 0 8px 25px rgba(245, 166, 35, 0.15),
                0 2px 8px rgba(0, 0, 0, 0.04);
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--success);
    animation: pulse-status 2s infinite;
}

.agent-status-badge.busy .status-dot { background: var(--danger); }
.agent-status-badge.pause .status-dot { background: var(--warning); animation: none; }
.agent-status-badge.acw .status-dot { background: var(--info); }
.agent-status-badge.waiting .status-dot { background: var(--primary); }

@keyframes pulse-status {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* Call Info Card - Şık Tasarım */
.call-info-card {
    background: linear-gradient(145deg, #ffffff, #f5f7fa);
    border: 1px solid rgba(0, 0, 0, 0.06);
    border-radius: var(--border-radius-lg);
    padding: 1.25rem;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.06),
                0 2px 10px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 1);
    position: relative;
    overflow: hidden;
}

.call-info-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #F5A623, #FFD700, #F5A623);
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
}

.call-info-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-color);
    color: var(--primary);
    font-weight: 600;
}

.call-number {
    font-family: var(--font-mono);
    font-size: 1.25rem;
    color: var(--primary);
    text-align: center;
    margin-bottom: 0.5rem;
}

.call-number-masked {
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: var(--text-secondary);
    text-align: center;
    margin-bottom: 0.5rem;
}

.call-customer-name {
    font-weight: 600;
    text-align: center;
    margin-bottom: 1rem;
}

.call-timer {
    font-family: var(--font-display);
    font-size: 2rem;
    font-weight: 700;
    text-align: center;
    color: var(--text-primary);
    padding: 1rem;
    background: var(--bg-darker);
    border-radius: var(--border-radius);
    margin-bottom: 1rem;
}

.call-timer.active {
    color: var(--success);
}

.call-timer.warning {
    color: var(--warning);
}

/* Call Controls */
.call-controls {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.call-control-btn {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 1.3rem;
    position: relative;
}

.call-control-btn.mute {
    background: linear-gradient(145deg, #f5f5f5, #e0e0e0);
    color: #555;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

.call-control-btn.mute:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.call-control-btn.mute.active {
    background: linear-gradient(145deg, #EF5350, #C62828);
    color: white;
    box-shadow: 0 4px 15px rgba(198, 40, 40, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.call-control-btn.record {
    background: linear-gradient(145deg, #f5f5f5, #e0e0e0);
    color: #EF5350;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

.call-control-btn.record.active {
    background: linear-gradient(145deg, #EF5350, #C62828);
    color: white;
    box-shadow: 0 4px 15px rgba(198, 40, 40, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
    animation: pulse-record 1.5s infinite;
}

@keyframes pulse-record {
    0%, 100% { 
        box-shadow: 0 4px 15px rgba(198, 40, 40, 0.4),
                    0 0 0 0 rgba(239, 68, 68, 0.4);
    }
    50% { 
        box-shadow: 0 4px 15px rgba(198, 40, 40, 0.4),
                    0 0 0 12px rgba(239, 68, 68, 0);
    }
}

.call-control-btn.dialpad {
    background: linear-gradient(145deg, #f5f5f5, #e0e0e0);
    color: #555;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

.call-control-btn.dialpad:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    color: #F57C00;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.875rem 1rem;
    border-radius: var(--border-radius);
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all var(--transition-fast);
    width: 100%;
}

.action-btn {
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.85rem;
}

.action-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
}

.action-btn:hover::before {
    left: 100%;
}

.action-btn.end-call {
    background: linear-gradient(145deg, #EF5350 0%, #C62828 100%);
    color: #ffffff;
    box-shadow: 0 4px 15px rgba(198, 40, 40, 0.3),
                0 2px 4px rgba(198, 40, 40, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
}

.action-btn.end-call:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(198, 40, 40, 0.4),
                0 4px 8px rgba(198, 40, 40, 0.3);
}

.action-btn.pause {
    background: linear-gradient(145deg, #FFB74D 0%, #F57C00 100%);
    color: #3E2723;
    box-shadow: 0 4px 15px rgba(245, 124, 0, 0.3),
                0 2px 4px rgba(245, 124, 0, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
}

.action-btn.pause:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(245, 124, 0, 0.4),
                0 4px 8px rgba(245, 124, 0, 0.3);
}

.action-btn.sales {
    background: linear-gradient(145deg, #81C784 0%, #388E3C 100%);
    color: #ffffff;
    box-shadow: 0 4px 15px rgba(56, 142, 60, 0.3),
                0 2px 4px rgba(56, 142, 60, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
}

.action-btn.sales:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(56, 142, 60, 0.4);
}

.action-btn.calendar {
    background: linear-gradient(145deg, #64B5F6 0%, #1565C0 100%);
    color: #ffffff;
    box-shadow: 0 4px 15px rgba(21, 101, 192, 0.3),
                0 2px 4px rgba(21, 101, 192, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
}

.action-btn.calendar:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(21, 101, 192, 0.4);
}

.action-btn.start {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: var(--bg-darkest);
}

/* Manual Call Section */
.manual-call-section {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 1rem;
}

.manual-call-section h4 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.manual-call-input {
    display: flex;
    gap: 0.5rem;
}

.manual-call-input input {
    flex: 1;
    padding: 0.75rem;
    background: var(--bg-darker);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    color: var(--text-primary);
    font-family: var(--font-mono);
}

.manual-call-input button {
    padding: 0.75rem 1.25rem;
    background: var(--primary);
    border: none;
    border-radius: var(--border-radius);
    color: var(--bg-darkest);
    cursor: pointer;
    transition: all var(--transition-fast);
}

/* IBAN Control Section */
.iban-section {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 0.75rem 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.iban-section i {
    transition: transform var(--transition-fast);
}

.iban-section.expanded i {
    transform: rotate(180deg);
}

/* Right Content Area */
.agent-main {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    overflow-y: auto;
}

/* Stats Bar */
.stats-bar {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 0.75rem;
}

.stat-card {
    padding: 1rem;
    border-radius: var(--border-radius);
    color: white;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    transform: translate(20px, -20px);
}

/* Şık glassmorphism kartlar */
.stat-card {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.5);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08),
                0 2px 8px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12),
                0 4px 12px rgba(0, 0, 0, 0.06);
}

.stat-card.blue { 
    background: linear-gradient(145deg, rgba(227, 242, 253, 0.9), rgba(187, 222, 251, 0.9));
    border-left: 4px solid #1E88E5;
}
.stat-card.green { 
    background: linear-gradient(145deg, rgba(232, 245, 233, 0.9), rgba(200, 230, 201, 0.9));
    border-left: 4px solid #43A047;
}
.stat-card.orange { 
    background: linear-gradient(145deg, rgba(255, 243, 224, 0.9), rgba(255, 224, 178, 0.9));
    border-left: 4px solid #F57C00;
}
.stat-card.red { 
    background: linear-gradient(145deg, rgba(255, 235, 238, 0.9), rgba(255, 205, 210, 0.9));
    border-left: 4px solid #E53935;
}
.stat-card.cyan { 
    background: linear-gradient(145deg, rgba(224, 247, 250, 0.9), rgba(178, 235, 242, 0.9));
    border-left: 4px solid #00ACC1;
}
.stat-card.purple { 
    background: linear-gradient(145deg, rgba(243, 229, 245, 0.9), rgba(225, 190, 231, 0.9));
    border-left: 4px solid #8E24AA;
}

.stat-card-inner {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stat-content {
    flex: 1;
}

.stat-value {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 700;
    line-height: 1;
    color: #1A1A1A;
}

.stat-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #555;
    margin-top: 0.25rem;
    font-weight: 600;
}

.stat-sublabel {
    font-size: 0.7rem;
    color: #888;
    margin-top: 0.25rem;
}

/* Tabs Section - Modern Tasarım */
.agent-tabs {
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    border: 1px solid rgba(0, 0, 0, 0.06);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    flex: 1;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.06),
                0 2px 10px rgba(0, 0, 0, 0.04);
}

.tabs-header {
    display: flex;
    background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    overflow-x: auto;
    padding: 0.5rem 0.5rem 0;
    gap: 0.25rem;
}

.tab-btn {
    padding: 0.75rem 1.25rem;
    background: transparent;
    border: none;
    border-radius: var(--border-radius) var(--border-radius) 0 0;
    color: #666;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    font-weight: 500;
    position: relative;
}

.tab-btn i {
    font-size: 1.1rem;
    transition: transform 0.2s ease;
}

.tab-btn:hover {
    color: #333;
    background: rgba(255, 255, 255, 0.7);
}

.tab-btn:hover i {
    transform: scale(1.1);
}

.tab-btn.active {
    color: #F57C00;
    background: #ffffff;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
}

.tab-btn.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #F5A623, #FFD700);
    border-radius: 3px 3px 0 0;
}

.tab-btn .badge {
    background: var(--primary);
    color: var(--bg-darkest);
    padding: 0.125rem 0.5rem;
    border-radius: 999px;
    font-size: 0.7rem;
    font-weight: 600;
}

.tabs-content {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
}

/* Queue Display - Agent slots */
.queue-display {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    padding: 0.75rem;
    background: var(--bg-darker);
    border-radius: var(--border-radius);
    overflow-x: auto;
}

.queue-slot {
    min-width: 80px;
    height: 50px;
    background: var(--bg-elevated);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--text-secondary);
    position: relative;
}

.queue-slot::before {
    content: attr(data-slot);
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary);
    color: var(--bg-darkest);
    padding: 0 0.5rem;
    font-size: 0.65rem;
    font-weight: 700;
    border-radius: 999px;
}

.queue-slot.active {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.1);
}

.queue-slot.waiting {
    border-color: var(--warning);
    background: rgba(245, 158, 11, 0.1);
    animation: pulse-waiting 2s infinite;
}

@keyframes pulse-waiting {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

/* Customer Form */
.customer-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-section {
    background: var(--bg-darker);
    padding: 1rem;
    border-radius: var(--border-radius);
}

.form-section-title {
    font-size: 0.75rem;
    text-transform: uppercase;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    letter-spacing: 0.5px;
}

.form-row {
    margin-bottom: 0.75rem;
}

.form-row label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
}

.form-row label .required {
    color: var(--danger);
}

.form-row input,
.form-row select,
.form-row textarea {
    width: 100%;
    padding: 0.625rem;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    color: var(--text-primary);
    font-size: 0.875rem;
}

.form-row input:focus,
.form-row select:focus,
.form-row textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
}

/* AI Assistant Panel */
.ai-panel {
    background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.1) 0%, rgba(var(--primary-rgb), 0.05) 100%);
    border: 1px solid rgba(var(--primary-rgb), 0.2);
    border-radius: var(--border-radius);
    padding: 1rem;
}

.ai-panel-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    color: var(--primary);
    font-weight: 600;
}

.ai-suggestion {
    background: var(--bg-card);
    border-radius: var(--border-radius-sm);
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    border-left: 3px solid var(--primary);
}

.ai-suggestion-title {
    font-size: 0.75rem;
    text-transform: uppercase;
    color: var(--primary);
    margin-bottom: 0.25rem;
}

.ai-sentiment {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
}

.sentiment-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.sentiment-bar {
    flex: 1;
    height: 8px;
    background: var(--bg-darker);
    border-radius: 999px;
    overflow: hidden;
    display: flex;
}

.sentiment-positive {
    background: var(--success);
    height: 100%;
}

.sentiment-neutral {
    background: var(--warning);
    height: 100%;
}

.sentiment-negative {
    background: var(--danger);
    height: 100%;
}

/* Disposition Modal */
.disposition-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.disposition-column h4 {
    font-size: 0.875rem;
    margin-bottom: 0.75rem;
    color: var(--text-secondary);
}

.disposition-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: var(--bg-darker);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    margin-bottom: 0.5rem;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.disposition-option:hover {
    border-color: var(--primary);
    background: var(--bg-hover);
}

.disposition-option.selected {
    border-color: var(--primary);
    background: rgba(var(--primary-rgb), 0.1);
}

.disposition-option input[type="radio"] {
    accent-color: var(--primary);
}

/* System Check Panel */
.system-check-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.system-check-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: var(--bg-darker);
    border-radius: var(--border-radius-sm);
}

.system-check-item .check-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
}

.system-check-item.success .check-icon {
    background: var(--success);
    color: white;
}

.system-check-item.error .check-icon {
    background: var(--danger);
    color: white;
}

.system-check-item.warning .check-icon {
    background: var(--warning);
    color: white;
}

.check-label {
    flex: 1;
    font-weight: 500;
}

.check-detail {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

/* Pause Modal */
.pause-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(4px);
}

.pause-modal {
    background: var(--bg-card);
    border-radius: var(--border-radius);
    padding: 2rem;
    width: 100%;
    max-width: 400px;
    text-align: center;
}

.pause-timer {
    font-family: var(--font-display);
    font-size: 4rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 1.5rem;
}

.pause-user-info {
    margin-bottom: 1.5rem;
}

.pause-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: var(--bg-darkest);
    margin: 0 auto 0.75rem;
}

.pause-username {
    font-weight: 600;
    font-size: 1.25rem;
}

.pause-role {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.pause-password {
    margin-bottom: 1rem;
}

.pause-password input {
    width: 100%;
    padding: 0.875rem;
    background: var(--bg-darker);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    color: var(--text-primary);
    text-align: center;
    font-size: 1rem;
}

/* Dialpad Modal */
.dialpad-modal {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 1rem;
    margin-bottom: 0.5rem;
    display: none;
    z-index: 10;
}

.dialpad-modal.show {
    display: block;
}

.dialpad-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
}

.dialpad-btn {
    width: 48px;
    height: 48px;
    border-radius: var(--border-radius-sm);
    background: var(--bg-darker);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    font-size: 1.25rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.dialpad-btn:hover {
    background: var(--primary);
    color: var(--bg-darkest);
    border-color: var(--primary);
}

/* Responsive */
@media (max-width: 1200px) {
    .agent-panel {
        grid-template-columns: 1fr;
    }
    
    .agent-sidebar {
        flex-direction: row;
        flex-wrap: wrap;
    }
    
    .stats-bar {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    .stats-bar {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .customer-form {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="agent-panel">
    <!-- Left Sidebar - Call Controls -->
    <div class="agent-sidebar">
        <!-- Agent Status -->
        <div class="agent-status-badge" id="agentStatusBadge">
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span id="statusText">Status: Hazır</span>
            </div>
        </div>
        
        <!-- Call Information Card -->
        <div class="call-info-card">
            <div class="call-info-header">
                <i class="ti ti-phone-call"></i>
                <span>Çağrı Bilgileri</span>
            </div>
            
            <div id="callInfoContent">
                <div class="call-number" id="callNumber">---</div>
                <div class="call-number-masked" id="callNumberMasked">--- ---</div>
                <div class="call-customer-name" id="callCustomerName">---</div>
                
                <div class="call-timer" id="callTimer">00:00:00</div>
                
                <div class="call-controls">
                    <button class="call-control-btn mute" id="btnMute" title="Mikrofonu Kapat/Aç">
                        <i class="ti ti-microphone"></i>
                    </button>
                    <button class="call-control-btn record active" id="btnRecord" title="Kayıt">
                        <i class="ti ti-circle-filled"></i>
                    </button>
                    <div style="position: relative;">
                        <button class="call-control-btn dialpad" id="btnDialpad" title="Tuş Takımı">
                            <i class="ti ti-dialpad"></i>
                        </button>
                        <div class="dialpad-modal" id="dialpadModal">
                            <div class="dialpad-grid">
                                <button class="dialpad-btn" data-digit="1">1</button>
                                <button class="dialpad-btn" data-digit="2">2</button>
                                <button class="dialpad-btn" data-digit="3">3</button>
                                <button class="dialpad-btn" data-digit="4">4</button>
                                <button class="dialpad-btn" data-digit="5">5</button>
                                <button class="dialpad-btn" data-digit="6">6</button>
                                <button class="dialpad-btn" data-digit="7">7</button>
                                <button class="dialpad-btn" data-digit="8">8</button>
                                <button class="dialpad-btn" data-digit="9">9</button>
                                <button class="dialpad-btn" data-digit="*">*</button>
                                <button class="dialpad-btn" data-digit="0">0</button>
                                <button class="dialpad-btn" data-digit="#">#</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-btn start" id="btnStart">
                <i class="ti ti-player-play"></i>
                <span>Başlat</span>
            </button>
            <button class="action-btn end-call" id="btnEndCall" style="display: none;">
                <i class="ti ti-phone-off"></i>
                <span>Çağrıyı Bitir</span>
            </button>
            <button class="action-btn pause" id="btnPause">
                <i class="ti ti-clock-pause"></i>
                <span>Mola</span>
            </button>
            <button class="action-btn sales" id="btnSales" style="display: none;">
                <i class="ti ti-shopping-cart"></i>
                <span>Satış</span>
            </button>
            <button class="action-btn calendar" id="btnCalendar">
                <i class="ti ti-calendar-plus"></i>
                <span>Takvime Kaydet</span>
            </button>
        </div>
        
        <!-- Manual Call -->
        <div class="manual-call-section">
            <h4><i class="ti ti-phone"></i> Manuel Arama</h4>
            <div class="manual-call-input">
                <input type="tel" id="manualNumber" placeholder="Numara Girin">
                <button id="btnManualCall">
                    <i class="ti ti-phone"></i>
                </button>
            </div>
        </div>
        
        <!-- IBAN Control -->
        <div class="iban-section" id="ibanSection">
            <span><i class="ti ti-credit-card"></i> IBAN Kontrolü</span>
            <i class="ti ti-chevron-down"></i>
        </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="agent-main">
        <!-- Stats Bar - 3D İkonlu -->
        <div class="stats-bar">
            <div class="stat-card blue">
                <div class="stat-card-inner">
                    <div class="icon-3d blue">
                        <i class="ti ti-phone-call"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="statCalls">0</div>
                        <div class="stat-label">Çağrı Sayısı</div>
                        <div class="stat-sublabel">Bu Ay: <span id="statCallsMonth">0</span></div>
                    </div>
                </div>
            </div>
            <div class="stat-card green">
                <div class="stat-card-inner">
                    <div class="icon-3d green">
                        <i class="ti ti-circle-check"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="statQcOk">0</div>
                        <div class="stat-label">Q.C. OK</div>
                        <div class="stat-sublabel">Bu Ay: <span id="statQcMonth">0</span></div>
                    </div>
                </div>
            </div>
            <div class="stat-card orange">
                <div class="stat-card-inner">
                    <div class="icon-3d orange">
                        <i class="ti ti-x"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="statSalesCancelled">0</div>
                        <div class="stat-label">İptal Satış</div>
                        <div class="stat-sublabel">Bu Ay: <span id="statCancelMonth">0</span></div>
                    </div>
                </div>
            </div>
            <div class="stat-card red">
                <div class="stat-card-inner">
                    <div class="icon-3d red">
                        <i class="ti ti-clock-pause"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="statPauseTime">00:00:00</div>
                        <div class="stat-label">Mola Süresi</div>
                        <div class="stat-sublabel">Ort: <span id="statPauseAvg">00:00:00</span></div>
                    </div>
                </div>
            </div>
            <div class="stat-card cyan">
                <div class="stat-card-inner">
                    <div class="icon-3d cyan">
                        <i class="ti ti-phone-incoming"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="statCallbacks">0</div>
                        <div class="stat-label">Geri Arama</div>
                        <div class="stat-sublabel">Bekleyen: <span id="statCallbacksPending">0</span></div>
                    </div>
                </div>
            </div>
            <div class="stat-card purple">
                <div class="stat-card-inner">
                    <div class="icon-3d purple">
                        <i class="ti ti-shopping-cart"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="statTotalSales">0</div>
                        <div class="stat-label">Toplam Satış</div>
                        <div class="stat-sublabel">Bu Ay: <span id="statSalesMonth">0</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tabs Section -->
        <div class="agent-tabs">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="agentDisplay">
                    <i class="ti ti-grid-3x3"></i> Agent Display
                </button>
                <button class="tab-btn" data-tab="oldSales">
                    <i class="ti ti-history"></i> Eski Satışlar
                </button>
                <button class="tab-btn" data-tab="sales">
                    <i class="ti ti-shopping-cart"></i> Satışlar
                </button>
                <button class="tab-btn" data-tab="headset">
                    <i class="ti ti-headset"></i> Kulaklık
                </button>
                <button class="tab-btn" data-tab="salesStatus">
                    <i class="ti ti-chart-dots"></i> Satış Durumu
                    <span class="badge">0</span>
                </button>
                <button class="tab-btn" data-tab="waitingCalls">
                    <i class="ti ti-phone-incoming"></i> Bekleyen Çağrılar
                </button>
                <button class="tab-btn" data-tab="ai">
                    <i class="ti ti-robot"></i> AI Asistan
                </button>
            </div>
            
            <div class="tabs-content">
                <!-- Agent Display Tab -->
                <div class="tab-pane active" id="agentDisplay">
                    <!-- Queue Slots -->
                    <div class="queue-display">
                        <div class="queue-slot" data-slot="1"></div>
                        <div class="queue-slot" data-slot="2"></div>
                        <div class="queue-slot" data-slot="3"></div>
                        <div class="queue-slot" data-slot="4"></div>
                        <div class="queue-slot" data-slot="5"></div>
                        <div class="queue-slot" data-slot="6"></div>
                        <div class="queue-slot" data-slot="7"></div>
                    </div>
                    
                    <!-- Customer Form -->
                    <div class="customer-form">
                        <div class="form-section">
                            <div class="form-section-title">Kişisel Bilgiler</div>
                            
                            <div class="form-row">
                                <label>Hitap <span class="required">*</span></label>
                                <select id="customerSalutation">
                                    <option value="">Seçiniz</option>
                                    <option value="bay">Bay</option>
                                    <option value="bayan">Bayan</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label>Ad <span class="required">*</span></label>
                                <input type="text" id="customerFirstName" placeholder="Ad">
                            </div>
                            
                            <div class="form-row">
                                <label>Soyad <span class="required">*</span></label>
                                <input type="text" id="customerLastName" placeholder="Soyad">
                            </div>
                            
                            <div class="form-row">
                                <label>Doğum Tarihi</label>
                                <input type="date" id="customerBirthDate">
                            </div>
                            
                            <div class="form-row">
                                <label>Telefon <span class="required">*</span></label>
                                <input type="tel" id="customerPhone" placeholder="Telefon">
                            </div>
                            
                            <div class="form-row">
                                <label>Telefon 2</label>
                                <input type="tel" id="customerPhone2" placeholder="Alternatif Telefon">
                            </div>
                            
                            <div class="form-row">
                                <label>E-posta</label>
                                <input type="email" id="customerEmail" placeholder="E-posta">
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <div class="form-section-title">Adres & Banka Bilgileri</div>
                            
                            <div class="form-row">
                                <label>Sokak <span class="required">*</span></label>
                                <input type="text" id="customerStreet" placeholder="Sokak/Cadde">
                            </div>
                            
                            <div class="form-row">
                                <label>Kapı No <span class="required">*</span></label>
                                <input type="text" id="customerHouseNo" placeholder="Kapı No">
                            </div>
                            
                            <div class="form-row">
                                <label>Posta Kodu <span class="required">*</span></label>
                                <input type="text" id="customerZip" placeholder="Posta Kodu">
                            </div>
                            
                            <div class="form-row">
                                <label>Şehir <span class="required">*</span></label>
                                <input type="text" id="customerCity" placeholder="Şehir">
                            </div>
                            
                            <div class="form-row">
                                <label>Banka Adı</label>
                                <input type="text" id="customerBank" placeholder="Banka">
                            </div>
                            
                            <div class="form-row">
                                <label>IBAN <span class="required">*</span></label>
                                <input type="text" id="customerIban" placeholder="IBAN">
                            </div>
                            
                            <div class="form-row">
                                <label>BIC</label>
                                <input type="text" id="customerBic" placeholder="BIC">
                            </div>
                            
                            <div class="form-row">
                                <label>Not</label>
                                <textarea id="customerNote" rows="3" placeholder="Notlar..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="btn btn-primary">
                            <i class="ti ti-device-floppy"></i> Kaydet
                        </button>
                        <button class="btn btn-secondary" id="btnShowDisposition">
                            <i class="ti ti-circle-check"></i> Sonuç (Disposition)
                        </button>
                    </div>
                </div>
                
                <!-- Old Sales Tab -->
                <div class="tab-pane" id="oldSales">
                    <div class="empty-state">
                        <i class="ti ti-history" style="font-size: 3rem; color: var(--text-muted);"></i>
                        <p>Geçmiş satış kaydı bulunmuyor</p>
                    </div>
                </div>
                
                <!-- Sales Tab -->
                <div class="tab-pane" id="sales">
                    <div class="empty-state">
                        <i class="ti ti-shopping-cart" style="font-size: 3rem; color: var(--text-muted);"></i>
                        <p>Aktif satış bulunmuyor</p>
                    </div>
                </div>
                
                <!-- Headset Tab -->
                <div class="tab-pane" id="headset">
                    <h3 style="margin-bottom: 1rem;">Sistem Kontrolü</h3>
                    <div class="system-check-list" id="systemCheckList">
                        <div class="system-check-item" id="checkIp">
                            <div class="check-icon"><i class="ti ti-loader"></i></div>
                            <span class="check-label">IP Adresi</span>
                            <span class="check-detail" id="ipDetail">Kontrol ediliyor...</span>
                        </div>
                        <div class="system-check-item" id="checkMic">
                            <div class="check-icon"><i class="ti ti-loader"></i></div>
                            <span class="check-label">Mikrofon İzni</span>
                            <span class="check-detail" id="micDetail">Kontrol ediliyor...</span>
                        </div>
                        <div class="system-check-item" id="checkPing">
                            <div class="check-icon"><i class="ti ti-loader"></i></div>
                            <span class="check-label">Ping</span>
                            <span class="check-detail" id="pingDetail">Kontrol ediliyor...</span>
                        </div>
                        <div class="system-check-item" id="checkBrowser">
                            <div class="check-icon"><i class="ti ti-loader"></i></div>
                            <span class="check-label">Web Tarayıcı</span>
                            <span class="check-detail" id="browserDetail">Kontrol ediliyor...</span>
                        </div>
                        <div class="system-check-item" id="checkHeadset">
                            <div class="check-icon"><i class="ti ti-loader"></i></div>
                            <span class="check-label">Kulaklık</span>
                            <span class="check-detail" id="headsetDetail">Kontrol ediliyor...</span>
                        </div>
                        <div class="system-check-item" id="checkWebRTC">
                            <div class="check-icon"><i class="ti ti-loader"></i></div>
                            <span class="check-label">WebRTC</span>
                            <span class="check-detail" id="webrtcDetail">Kontrol ediliyor...</span>
                        </div>
                        <div class="system-check-item" id="checkWebSocket">
                            <div class="check-icon"><i class="ti ti-loader"></i></div>
                            <span class="check-label">WebSocket</span>
                            <span class="check-detail" id="websocketDetail">Kontrol ediliyor...</span>
                        </div>
                    </div>
                    <button class="btn btn-primary mt-4" id="btnRecheck">
                        <i class="ti ti-refresh"></i> Tekrar Kontrol Et
                    </button>
                </div>
                
                <!-- Sales Status Tab -->
                <div class="tab-pane" id="salesStatus">
                    <div class="empty-state">
                        <i class="ti ti-chart-dots" style="font-size: 3rem; color: var(--text-muted);"></i>
                        <p>Satış durumu verisi bulunmuyor</p>
                    </div>
                </div>
                
                <!-- Waiting Calls Tab -->
                <div class="tab-pane" id="waitingCalls">
                    <div class="empty-state">
                        <i class="ti ti-phone-incoming" style="font-size: 3rem; color: var(--text-muted);"></i>
                        <p>Bekleyen çağrı bulunmuyor</p>
                    </div>
                </div>
                
                <!-- AI Assistant Tab -->
                <div class="tab-pane" id="ai">
                    <div class="ai-panel">
                        <div class="ai-panel-header">
                            <i class="ti ti-robot"></i>
                            <span>AI Çağrı Asistanı</span>
                        </div>
                        
                        <div class="ai-suggestion">
                            <div class="ai-suggestion-title">Önerilen Script</div>
                            <p>"Merhaba, ben {{ current_user.full_name or current_user.username }}, AI BEE CC'den arıyorum. Nasılsınız bugün?"</p>
                        </div>
                        
                        <div class="ai-suggestion">
                            <div class="ai-suggestion-title">Anlık Öneri</div>
                            <p id="aiLiveSuggestion">Çağrı başladığında AI önerileri burada görünecek...</p>
                        </div>
                        
                        <div class="ai-suggestion">
                            <div class="ai-suggestion-title">Bilgi Tabanı</div>
                            <p id="aiKnowledgeBase">İlgili bilgiler çağrı sırasında otomatik getirilecek...</p>
                        </div>
                        
                        <div class="ai-sentiment">
                            <span class="sentiment-label">Müşteri Duygu Durumu:</span>
                            <div class="sentiment-bar">
                                <div class="sentiment-positive" style="width: 33%;"></div>
                                <div class="sentiment-neutral" style="width: 34%;"></div>
                                <div class="sentiment-negative" style="width: 33%;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h4 style="margin-bottom: 0.75rem;"><i class="ti ti-wand"></i> Otomatik Özet</h4>
                        <div class="card" style="background: var(--bg-darker);">
                            <div class="card-body">
                                <p id="aiCallSummary" class="text-muted">Çağrı tamamlandığında AI özeti burada görünecek...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pause Modal -->
<div class="pause-modal-overlay" id="pauseModal" style="display: none;">
    <div class="pause-modal">
        <div class="pause-timer" id="pauseTimer">00:00:00</div>
        <h3 style="margin-bottom: 1.5rem;">Mola Bitir</h3>
        
        <div class="pause-user-info">
            <div class="pause-avatar">
                {{ current_user.get_initials() if current_user.get_initials else 'A' }}
            </div>
            <div class="pause-username">{{ current_user.full_name or current_user.username }}</div>
            <div class="pause-role">Agent</div>
        </div>
        
        <div class="pause-password">
            <label style="display: block; text-align: left; margin-bottom: 0.5rem; color: var(--text-secondary);">Şifre</label>
            <input type="password" id="pausePassword" placeholder="Şifrenizi girin">
        </div>
        
        <button class="btn btn-primary" style="width: 100%;" id="btnEndPause">
            <i class="ti ti-player-play"></i> Giriş
        </button>
    </div>
</div>

<!-- Disposition Modal -->
<div class="pause-modal-overlay" id="dispositionModal" style="display: none;">
    <div class="pause-modal" style="max-width: 700px;">
        <h3 style="margin-bottom: 1rem;"><i class="ti ti-clipboard-check"></i> Arama Sonucu</h3>
        
        <div class="mb-4">
            <label style="display: block; text-align: left; margin-bottom: 0.5rem;">Görüşme Notu</label>
            <textarea id="callNote" rows="3" style="width: 100%; padding: 0.75rem; background: var(--bg-darker); border: 1px solid var(--border-color); border-radius: var(--border-radius); color: var(--text-primary);"></textarea>
        </div>
        
        <div class="disposition-grid">
            <div class="disposition-column">
                <h4>Negatif Sonuçlar</h4>
                <div class="disposition-option" data-value="wrong_number">
                    <input type="radio" name="disposition" value="wrong_number">
                    <span>Yanlış Numara</span>
                </div>
                <div class="disposition-option" data-value="blacklist">
                    <input type="radio" name="disposition" value="blacklist">
                    <span>Kara Liste</span>
                </div>
                <div class="disposition-option" data-value="no_answer">
                    <input type="radio" name="disposition" value="no_answer">
                    <span>Ulaşılamadı</span>
                </div>
                <div class="disposition-option" data-value="voicemail">
                    <input type="radio" name="disposition" value="voicemail">
                    <span>Telesekreter</span>
                </div>
                <div class="disposition-option" data-value="no_interest">
                    <input type="radio" name="disposition" value="no_interest">
                    <span>İlgilenmiyor</span>
                </div>
            </div>
            
            <div class="disposition-column">
                <h4>Pozitif Sonuçlar</h4>
                <div class="disposition-option" data-value="sale_ok">
                    <input type="radio" name="disposition" value="sale_ok">
                    <span>SATIŞ OK</span>
                </div>
                <div class="disposition-option" data-value="callback">
                    <input type="radio" name="disposition" value="callback">
                    <span>Geri Arama</span>
                </div>
                <div class="disposition-option" data-value="interested">
                    <input type="radio" name="disposition" value="interested">
                    <span>İlgileniyor</span>
                </div>
                <div class="disposition-option" data-value="info_sent">
                    <input type="radio" name="disposition" value="info_sent">
                    <span>Bilgi Gönderildi</span>
                </div>
            </div>
        </div>
        
        <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
            <button class="btn btn-secondary" id="btnCloseDisposition" style="flex: 1;">
                <i class="ti ti-x"></i> İptal
            </button>
            <button class="btn btn-primary" id="btnSaveDisposition" style="flex: 1;">
                <i class="ti ti-check"></i> Kaydet
            </button>
        </div>
    </div>
</div>

<!-- Pause Type Selection Modal -->
<div class="pause-modal-overlay" id="pauseTypeModal" style="display: none;">
    <div class="pause-modal" style="max-width: 400px;">
        <h3 style="margin-bottom: 1rem;"><i class="ti ti-clock-pause"></i> Mola Türü Seçin</h3>
        
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            <button class="btn btn-secondary" data-pause-type="pause" style="justify-content: flex-start;">
                <i class="ti ti-coffee"></i> Mola
            </button>
            <button class="btn btn-secondary" data-pause-type="system_error" style="justify-content: flex-start;">
                <i class="ti ti-alert-triangle"></i> Sistem Hatası
            </button>
            <button class="btn btn-secondary" data-pause-type="meeting" style="justify-content: flex-start;">
                <i class="ti ti-users"></i> Takım Toplantısı
            </button>
            <button class="btn btn-secondary" data-pause-type="meal" style="justify-content: flex-start;">
                <i class="ti ti-soup"></i> Yemek Molası
            </button>
            <button class="btn btn-secondary" data-pause-type="tea" style="justify-content: flex-start;">
                <i class="ti ti-cup"></i> Çay Molası
            </button>
            <button class="btn btn-secondary" data-pause-type="wc" style="justify-content: flex-start;">
                <i class="ti ti-bath"></i> WC
            </button>
        </div>
        
        <div style="margin-top: 1rem;">
            <label style="display: block; text-align: left; margin-bottom: 0.5rem; color: var(--text-secondary);">Açıklama</label>
            <textarea id="pauseDescription" rows="2" style="width: 100%; padding: 0.75rem; background: var(--bg-darker); border: 1px solid var(--border-color); border-radius: var(--border-radius); color: var(--text-primary);"></textarea>
        </div>
        
        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button class="btn btn-secondary" id="btnCancelPause" style="flex: 1;">
                <i class="ti ti-x"></i> İptal
            </button>
            <button class="btn btn-primary" id="btnConfirmPause" style="flex: 1;">
                <i class="ti ti-check"></i> Tamam
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const statusBadge = document.getElementById('agentStatusBadge');
    const statusText = document.getElementById('statusText');
    const callTimer = document.getElementById('callTimer');
    const pauseTimer = document.getElementById('pauseTimer');
    const pauseModal = document.getElementById('pauseModal');
    const pauseTypeModal = document.getElementById('pauseTypeModal');
    const dispositionModal = document.getElementById('dispositionModal');
    
    // State
    let isInCall = false;
    let isPaused = false;
    let callStartTime = null;
    let pauseStartTime = null;
    let timerInterval = null;
    let pauseTimerInterval = null;
    let selectedPauseType = null;
    
    // Tab functionality
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Dialpad toggle
    const btnDialpad = document.getElementById('btnDialpad');
    const dialpadModal = document.getElementById('dialpadModal');
    
    btnDialpad.addEventListener('click', function() {
        dialpadModal.classList.toggle('show');
    });
    
    document.querySelectorAll('.dialpad-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const digit = this.dataset.digit;
            console.log('DTMF:', digit);
            // Send DTMF tone via WebRTC
        });
    });
    
    // Mute toggle
    const btnMute = document.getElementById('btnMute');
    btnMute.addEventListener('click', function() {
        this.classList.toggle('active');
        const icon = this.querySelector('i');
        icon.className = this.classList.contains('active') ? 'ti ti-microphone-off' : 'ti ti-microphone';
    });
    
    // Start button
    document.getElementById('btnStart').addEventListener('click', function() {
        if (!isInCall) {
            startDialer();
        }
    });
    
    // End call button
    document.getElementById('btnEndCall').addEventListener('click', function() {
        if (isInCall) {
            endCall();
        }
    });
    
    // Pause button
    document.getElementById('btnPause').addEventListener('click', function() {
        if (!isPaused) {
            pauseTypeModal.style.display = 'flex';
        }
    });
    
    // Pause type selection
    document.querySelectorAll('[data-pause-type]').forEach(btn => {
        btn.addEventListener('click', function() {
            selectedPauseType = this.dataset.pauseType;
            document.querySelectorAll('[data-pause-type]').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
    
    // Cancel pause
    document.getElementById('btnCancelPause').addEventListener('click', function() {
        pauseTypeModal.style.display = 'none';
        selectedPauseType = null;
    });
    
    // Confirm pause
    document.getElementById('btnConfirmPause').addEventListener('click', function() {
        if (selectedPauseType) {
            pauseTypeModal.style.display = 'none';
            startPause();
        }
    });
    
    // End pause
    document.getElementById('btnEndPause').addEventListener('click', function() {
        const password = document.getElementById('pausePassword').value;
        if (password) {
            endPause();
        }
    });
    
    // Disposition modal
    document.getElementById('btnShowDisposition').addEventListener('click', function() {
        dispositionModal.style.display = 'flex';
    });
    
    document.getElementById('btnCloseDisposition').addEventListener('click', function() {
        dispositionModal.style.display = 'none';
    });
    
    document.querySelectorAll('.disposition-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.disposition-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            this.querySelector('input').checked = true;
        });
    });
    
    document.getElementById('btnSaveDisposition').addEventListener('click', function() {
        const selectedDispo = document.querySelector('input[name="disposition"]:checked');
        const note = document.getElementById('callNote').value;
        
        if (selectedDispo) {
            console.log('Disposition:', selectedDispo.value, 'Note:', note);
            dispositionModal.style.display = 'none';
            // Save disposition via API
        }
    });
    
    // Functions
    function startDialer() {
        isInCall = true;
        callStartTime = new Date();
        
        statusBadge.className = 'agent-status-badge waiting';
        statusText.textContent = 'Status: Arama Yapılıyor...';
        
        document.getElementById('btnStart').style.display = 'none';
        document.getElementById('btnEndCall').style.display = 'block';
        document.getElementById('btnSales').style.display = 'block';
        
        // Simulate call connection
        setTimeout(() => {
            statusBadge.className = 'agent-status-badge busy';
            statusText.textContent = 'Status: Görüşmede';
            callTimer.classList.add('active');
        }, 2000);
        
        // Start timer
        timerInterval = setInterval(updateCallTimer, 1000);
    }
    
    function endCall() {
        isInCall = false;
        clearInterval(timerInterval);
        
        statusBadge.className = 'agent-status-badge acw';
        statusText.textContent = 'Status: ACW (Çağrı Sonrası)';
        callTimer.classList.remove('active');
        
        document.getElementById('btnStart').style.display = 'block';
        document.getElementById('btnEndCall').style.display = 'none';
        document.getElementById('btnSales').style.display = 'none';
        
        // Show disposition modal
        dispositionModal.style.display = 'flex';
    }
    
    function updateCallTimer() {
        if (callStartTime) {
            const elapsed = Math.floor((new Date() - callStartTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            
            callTimer.textContent = 
                String(hours).padStart(2, '0') + ':' +
                String(minutes).padStart(2, '0') + ':' +
                String(seconds).padStart(2, '0');
            
            // Warning at 5 minutes
            if (elapsed > 300) {
                callTimer.classList.add('warning');
            }
        }
    }
    
    function startPause() {
        isPaused = true;
        pauseStartTime = new Date();
        
        statusBadge.className = 'agent-status-badge pause';
        statusText.textContent = 'Status: Mola';
        
        pauseModal.style.display = 'flex';
        
        pauseTimerInterval = setInterval(updatePauseTimer, 1000);
        
        // Notify server
        if (typeof socket !== 'undefined') {
            socket.emit('agent_pause', { type: selectedPauseType });
        }
    }
    
    function endPause() {
        isPaused = false;
        clearInterval(pauseTimerInterval);
        
        statusBadge.className = 'agent-status-badge';
        statusText.textContent = 'Status: Hazır';
        
        pauseModal.style.display = 'none';
        document.getElementById('pausePassword').value = '';
        
        // Notify server
        if (typeof socket !== 'undefined') {
            socket.emit('agent_unpause', {});
        }
    }
    
    function updatePauseTimer() {
        if (pauseStartTime) {
            const elapsed = Math.floor((new Date() - pauseStartTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            
            pauseTimer.textContent = 
                String(hours).padStart(2, '0') + ':' +
                String(minutes).padStart(2, '0') + ':' +
                String(seconds).padStart(2, '0');
        }
    }
    
    // System check
    function runSystemCheck() {
        // Check IP
        updateCheckItem('checkIp', 'success', 'IP Adresi', 'Bağlantı OK');
        
        // Check microphone
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                updateCheckItem('checkMic', 'success', 'Mikrofon İzni', 'İzin verildi');
                stream.getTracks().forEach(track => track.stop());
            })
            .catch(err => {
                updateCheckItem('checkMic', 'error', 'Mikrofon İzni', 'İzin verilmedi');
            });
        
        // Check browser
        const browserInfo = navigator.userAgent;
        const isChrome = browserInfo.includes('Chrome');
        updateCheckItem('checkBrowser', isChrome ? 'success' : 'warning', 'Web Tarayıcı', 
            isChrome ? 'Chrome - Destekleniyor' : 'Farklı tarayıcı');
        
        // Check WebRTC
        if (window.RTCPeerConnection) {
            updateCheckItem('checkWebRTC', 'success', 'WebRTC', 'Destekleniyor');
        } else {
            updateCheckItem('checkWebRTC', 'error', 'WebRTC', 'Desteklenmiyor');
        }
        
        // Check WebSocket
        if (typeof socket !== 'undefined' && socket.connected) {
            updateCheckItem('checkWebSocket', 'success', 'WebSocket', 'Bağlı');
        } else {
            updateCheckItem('checkWebSocket', 'warning', 'WebSocket', 'Bağlantı bekleniyor');
        }
        
        // Check audio devices
        navigator.mediaDevices.enumerateDevices()
            .then(devices => {
                const audioOutputs = devices.filter(d => d.kind === 'audiooutput');
                const audioInputs = devices.filter(d => d.kind === 'audioinput');
                
                updateCheckItem('checkHeadset', audioOutputs.length > 0 ? 'success' : 'error', 
                    'Kulaklık', audioOutputs.length + ' cihaz bulundu');
                    
                // Ping simulation
                const pingTime = Math.floor(Math.random() * 50) + 20;
                updateCheckItem('checkPing', pingTime < 100 ? 'success' : 'warning', 
                    'Ping', pingTime + ' ms');
            });
    }
    
    function updateCheckItem(id, status, label, detail) {
        const item = document.getElementById(id);
        item.className = 'system-check-item ' + status;
        
        const icon = item.querySelector('.check-icon i');
        icon.className = status === 'success' ? 'ti ti-check' : 
                         status === 'error' ? 'ti ti-x' : 'ti ti-alert-triangle';
        
        item.querySelector('.check-label').textContent = label;
        item.querySelector('.check-detail').textContent = detail;
    }
    
    // Run system check on page load
    setTimeout(runSystemCheck, 500);
    
    // Recheck button
    document.getElementById('btnRecheck').addEventListener('click', function() {
        document.querySelectorAll('.system-check-item').forEach(item => {
            item.className = 'system-check-item';
            item.querySelector('.check-icon i').className = 'ti ti-loader';
            item.querySelector('.check-detail').textContent = 'Kontrol ediliyor...';
        });
        
        setTimeout(runSystemCheck, 500);
    });
    
    // WebSocket events
    if (typeof socket !== 'undefined') {
        socket.on('connect', function() {
            console.log('Agent connected to server');
            updateCheckItem('checkWebSocket', 'success', 'WebSocket', 'Bağlı');
        });
        
        socket.on('new_call', function(data) {
            document.getElementById('callNumber').textContent = data.caller_id || '---';
            document.getElementById('callNumberMasked').textContent = data.masked_number || '--- ---';
            document.getElementById('callCustomerName').textContent = data.customer_name || '---';
            
            // Auto-fill customer form if data available
            if (data.customer) {
                document.getElementById('customerFirstName').value = data.customer.first_name || '';
                document.getElementById('customerLastName').value = data.customer.last_name || '';
                document.getElementById('customerPhone').value = data.customer.phone || '';
            }
        });
        
        socket.on('ai_suggestion', function(data) {
            document.getElementById('aiLiveSuggestion').textContent = data.suggestion;
        });
        
        socket.on('call_ended', function(data) {
            if (isInCall) {
                endCall();
            }
        });
    }
});
</script>
{% endblock %}
