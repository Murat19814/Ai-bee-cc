{% extends "base.html" %}

{% block title %}Kurum Ayarları - AI BEE CC{% endblock %}

{% block extra_css %}
<style>
.settings-page {
    padding: 1.5rem;
}

.page-header-settings {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.page-header-settings h1 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    color: #1a1a2e;
}

.page-header-settings h1 i { color: #F5A623; }

.page-header-settings p {
    color: #888;
    font-size: 0.9rem;
    margin-top: 0.25rem;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 1.5rem;
}

.settings-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
}

.settings-card-header {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f0f0f0;
}

.settings-card-header h3 {
    font-size: 1rem;
    color: #1a1a2e;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
}

.settings-card-header h3 i { color: #F5A623; }

.form-group {
    margin-bottom: 1.25rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #333;
    font-size: 0.85rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e8e8e8;
    border-radius: 10px;
    font-size: 0.9rem;
    transition: all 0.3s;
    background: #fafafa;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #F5A623;
    background: white;
    box-shadow: 0 0 0 4px rgba(245, 166, 35, 0.1);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
}

.checkbox-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: #f8f9fa;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.85rem;
}

.checkbox-item:hover { background: #f0f0f0; }

.checkbox-item input { width: auto; }

.checkbox-item.checked {
    background: #e8f5e9;
    color: #2e7d32;
}

.color-picker-group {
    display: flex;
    gap: 1rem;
}

.color-picker {
    flex: 1;
    text-align: center;
}

.color-picker label {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 0.8rem;
    color: #666;
}

.color-picker input[type="color"] {
    width: 100%;
    height: 50px;
    padding: 0;
    border: 2px solid #e8e8e8;
    border-radius: 10px;
    cursor: pointer;
}

.file-upload {
    border: 2px dashed #e0e0e0;
    padding: 1.5rem;
    text-align: center;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    background: #fafafa;
}

.file-upload:hover {
    border-color: #F5A623;
    background: #fff8e7;
}

.file-upload input[type="file"] {
    display: none;
}

.file-upload-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 0.5rem;
}

.file-upload span {
    display: block;
    font-size: 0.8rem;
    color: #888;
}

.btn-save {
    background: linear-gradient(135deg, #F5A623 0%, #e09800 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s;
    margin-top: 0.5rem;
}

.btn-save:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(245, 166, 35, 0.4);
}

/* Notification Settings */
.notification-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.notification-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 10px;
}

.notification-item-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.notification-item-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
}

.notification-item-icon.email { background: linear-gradient(135deg, #2196F3, #1976D2); }
.notification-item-icon.sms { background: linear-gradient(135deg, #4CAF50, #388E3C); }
.notification-item-icon.push { background: linear-gradient(135deg, #9C27B0, #7B1FA2); }
.notification-item-icon.slack { background: linear-gradient(135deg, #4A154B, #3a1040); }

.notification-item-text {
    font-weight: 500;
    font-size: 0.9rem;
}

.notification-item-desc {
    font-size: 0.75rem;
    color: #888;
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    width: 50px;
    height: 26px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .3s;
    border-radius: 26px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .3s;
    border-radius: 50%;
}

.toggle-switch input:checked + .toggle-slider {
    background-color: #4CAF50;
}

.toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(24px);
}

/* Security Section */
.security-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 0.75rem;
}

.security-item:last-child { margin-bottom: 0; }

.security-info h4 {
    margin: 0 0 0.25rem 0;
    font-size: 0.9rem;
}

.security-info p {
    margin: 0;
    font-size: 0.8rem;
    color: #888;
}

.security-action {
    padding: 0.5rem 1rem;
    border: 1px solid #e0e0e0;
    background: white;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.2s;
}

.security-action:hover {
    border-color: #F5A623;
    color: #F5A623;
}
</style>
{% endblock %}

{% block content %}
<div class="settings-page">
    <div class="page-header-settings">
        <div>
            <h1>
                <i class="ti ti-building"></i>
                <span data-tr="Kurum Ayarları" data-de="Unternehmenseinstellungen">Kurum Ayarları</span>
            </h1>
            <p data-tr="Çağrı merkezinizin genel ayarlarını yönetin" data-de="Verwalten Sie die allgemeinen Einstellungen Ihres Call Centers">Çağrı merkezinizin genel ayarlarını yönetin</p>
        </div>
    </div>

    <div class="settings-grid">
        <!-- Genel Bilgiler -->
        <div class="settings-card">
            <div class="settings-card-header">
                <h3><i class="ti ti-info-circle"></i> <span data-tr="Genel Bilgiler" data-de="Allgemeine Informationen">Genel Bilgiler</span></h3>
            </div>
            <form id="generalForm" onsubmit="saveGeneral(event)">
                <div class="form-group">
                    <label data-tr="Kurum Adı" data-de="Unternehmensname">Kurum Adı</label>
                    <input type="text" id="companyName" value="AI Bee CC" data-tr-placeholder="Kurum adınız" data-de-placeholder="Ihr Unternehmensname">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-tr="Saat Dilimi" data-de="Zeitzone">Saat Dilimi</label>
                        <select id="timezone">
                            <option value="Europe/Istanbul">Türkiye (UTC+3)</option>
                            <option value="Europe/Berlin" selected>Deutschland (UTC+1)</option>
                            <option value="Europe/London">London (UTC+0)</option>
                            <option value="Europe/Paris">Paris (UTC+1)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-tr="Dil" data-de="Sprache">Dil</label>
                        <select id="language">
                            <option value="tr" data-tr="Türkçe" data-de="Türkisch">Türkçe</option>
                            <option value="de" data-tr="Almanca" data-de="Deutsch">Almanca</option>
                            <option value="en" data-tr="İngilizce" data-de="Englisch">İngilizce</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn-save">
                    <i class="ti ti-check"></i> <span data-tr="Kaydet" data-de="Speichern">Kaydet</span>
                </button>
            </form>
        </div>

        <!-- Çalışma Saatleri -->
        <div class="settings-card">
            <div class="settings-card-header">
                <h3><i class="ti ti-clock"></i> <span data-tr="Çalışma Saatleri" data-de="Arbeitszeiten">Çalışma Saatleri</span></h3>
            </div>
            <form id="hoursForm" onsubmit="saveHours(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label data-tr="Başlangıç" data-de="Beginn">Başlangıç</label>
                        <input type="time" id="workStart" value="09:00">
                    </div>
                    <div class="form-group">
                        <label data-tr="Bitiş" data-de="Ende">Bitiş</label>
                        <input type="time" id="workEnd" value="18:00">
                    </div>
                </div>
                <div class="form-group">
                    <label data-tr="Çalışma Günleri" data-de="Arbeitstage">Çalışma Günleri</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item checked"><input type="checkbox" checked> <span data-tr="Pazartesi" data-de="Montag">Pazartesi</span></label>
                        <label class="checkbox-item checked"><input type="checkbox" checked> <span data-tr="Salı" data-de="Dienstag">Salı</span></label>
                        <label class="checkbox-item checked"><input type="checkbox" checked> <span data-tr="Çarşamba" data-de="Mittwoch">Çarşamba</span></label>
                        <label class="checkbox-item checked"><input type="checkbox" checked> <span data-tr="Perşembe" data-de="Donnerstag">Perşembe</span></label>
                        <label class="checkbox-item checked"><input type="checkbox" checked> <span data-tr="Cuma" data-de="Freitag">Cuma</span></label>
                        <label class="checkbox-item"><input type="checkbox"> <span data-tr="Cumartesi" data-de="Samstag">Cumartesi</span></label>
                        <label class="checkbox-item"><input type="checkbox"> <span data-tr="Pazar" data-de="Sonntag">Pazar</span></label>
                    </div>
                </div>
                <button type="submit" class="btn-save">
                    <i class="ti ti-check"></i> <span data-tr="Kaydet" data-de="Speichern">Kaydet</span>
                </button>
            </form>
        </div>

        <!-- Fatura Bilgileri -->
        <div class="settings-card">
            <div class="settings-card-header">
                <h3><i class="ti ti-file-invoice"></i> <span data-tr="Fatura Bilgileri" data-de="Rechnungsinformationen">Fatura Bilgileri</span></h3>
            </div>
            <form id="billingForm" onsubmit="saveBilling(event)">
                <div class="form-group">
                    <label data-tr="Şirket Unvanı" data-de="Firmenname">Şirket Unvanı</label>
                    <input type="text" id="companyTitle" data-tr-placeholder="Şirket unvanı" data-de-placeholder="Firmenname">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-tr="Vergi Dairesi" data-de="Finanzamt">Vergi Dairesi</label>
                        <input type="text" id="taxOffice" data-tr-placeholder="Vergi dairesi" data-de-placeholder="Finanzamt">
                    </div>
                    <div class="form-group">
                        <label data-tr="Vergi No" data-de="Steuernummer">Vergi No</label>
                        <input type="text" id="taxNumber" data-tr-placeholder="Vergi numarası" data-de-placeholder="Steuernummer">
                    </div>
                </div>
                <div class="form-group">
                    <label data-tr="Adres" data-de="Adresse">Adres</label>
                    <textarea id="address" rows="2" data-tr-placeholder="Fatura adresi" data-de-placeholder="Rechnungsadresse"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-tr="Şehir" data-de="Stadt">Şehir</label>
                        <input type="text" id="city" data-tr-placeholder="Şehir" data-de-placeholder="Stadt">
                    </div>
                    <div class="form-group">
                        <label data-tr="Posta Kodu" data-de="Postleitzahl">Posta Kodu</label>
                        <input type="text" id="postalCode" data-tr-placeholder="Posta kodu" data-de-placeholder="PLZ">
                    </div>
                </div>
                <button type="submit" class="btn-save">
                    <i class="ti ti-check"></i> <span data-tr="Kaydet" data-de="Speichern">Kaydet</span>
                </button>
            </form>
        </div>

        <!-- Marka & Tema -->
        <div class="settings-card">
            <div class="settings-card-header">
                <h3><i class="ti ti-palette"></i> <span data-tr="Marka & Tema" data-de="Marke & Design">Marka & Tema</span></h3>
            </div>
            <form id="brandForm" onsubmit="saveBrand(event)">
                <div class="form-group">
                    <label data-tr="Logo (Açık Tema)" data-de="Logo (Helles Design)">Logo (Açık Tema)</label>
                    <div class="file-upload" onclick="document.getElementById('logoInput').click()">
                        <input type="file" id="logoInput" accept="image/*" onchange="handleLogoUpload(this)">
                        <span class="file-upload-btn" data-tr="Dosya Seç" data-de="Datei auswählen">Dosya Seç</span>
                        <span id="logoFileName" data-tr="Dosya seçilmedi" data-de="Keine Datei ausgewählt">Dosya seçilmedi</span>
                        <span>PNG veya SVG, max 1MB</span>
                    </div>
                </div>
                <div class="color-picker-group">
                    <div class="color-picker">
                        <label data-tr="Ana Renk" data-de="Hauptfarbe">Ana Renk</label>
                        <input type="color" id="primaryColor" value="#F5A623">
                    </div>
                    <div class="color-picker">
                        <label data-tr="İkincil Renk" data-de="Sekundärfarbe">İkincil Renk</label>
                        <input type="color" id="secondaryColor" value="#4A4A4A">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label data-tr="Varsayılan Tema" data-de="Standard-Design">Varsayılan Tema</label>
                    <select id="defaultTheme">
                        <option value="light" data-tr="Açık Tema" data-de="Helles Design">Açık Tema</option>
                        <option value="dark" data-tr="Koyu Tema" data-de="Dunkles Design">Koyu Tema</option>
                    </select>
                </div>
                <button type="submit" class="btn-save">
                    <i class="ti ti-check"></i> <span data-tr="Kaydet" data-de="Speichern">Kaydet</span>
                </button>
            </form>
        </div>

        <!-- Bildirim Ayarları -->
        <div class="settings-card">
            <div class="settings-card-header">
                <h3><i class="ti ti-bell"></i> <span data-tr="Bildirim Ayarları" data-de="Benachrichtigungseinstellungen">Bildirim Ayarları</span></h3>
            </div>
            <div class="notification-list">
                <div class="notification-item">
                    <div class="notification-item-info">
                        <div class="notification-item-icon email"><i class="ti ti-mail"></i></div>
                        <div>
                            <div class="notification-item-text" data-tr="E-posta Bildirimleri" data-de="E-Mail-Benachrichtigungen">E-posta Bildirimleri</div>
                            <div class="notification-item-desc" data-tr="Sistem bildirimleri ve raporlar" data-de="Systembenachrichtigungen und Berichte">Sistem bildirimleri ve raporlar</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleNotification('email', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="notification-item">
                    <div class="notification-item-info">
                        <div class="notification-item-icon sms"><i class="ti ti-message"></i></div>
                        <div>
                            <div class="notification-item-text" data-tr="SMS Bildirimleri" data-de="SMS-Benachrichtigungen">SMS Bildirimleri</div>
                            <div class="notification-item-desc" data-tr="Acil durum uyarıları" data-de="Notfall-Warnungen">Acil durum uyarıları</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" onchange="toggleNotification('sms', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="notification-item">
                    <div class="notification-item-info">
                        <div class="notification-item-icon push"><i class="ti ti-device-mobile"></i></div>
                        <div>
                            <div class="notification-item-text" data-tr="Push Bildirimleri" data-de="Push-Benachrichtigungen">Push Bildirimleri</div>
                            <div class="notification-item-desc" data-tr="Anlık bildirimler" data-de="Sofortige Benachrichtigungen">Anlık bildirimler</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleNotification('push', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="notification-item">
                    <div class="notification-item-info">
                        <div class="notification-item-icon slack"><i class="ti ti-brand-slack"></i></div>
                        <div>
                            <div class="notification-item-text">Slack</div>
                            <div class="notification-item-desc" data-tr="Ekip bildirimleri" data-de="Team-Benachrichtigungen">Ekip bildirimleri</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" onchange="toggleNotification('slack', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Güvenlik -->
        <div class="settings-card">
            <div class="settings-card-header">
                <h3><i class="ti ti-shield-lock"></i> <span data-tr="Güvenlik" data-de="Sicherheit">Güvenlik</span></h3>
            </div>
            <div class="security-item">
                <div class="security-info">
                    <h4 data-tr="İki Faktörlü Doğrulama" data-de="Zwei-Faktor-Authentifizierung">İki Faktörlü Doğrulama</h4>
                    <p data-tr="Hesabınızı daha güvenli hale getirin" data-de="Machen Sie Ihr Konto sicherer">Hesabınızı daha güvenli hale getirin</p>
                </div>
                <button class="security-action" onclick="setup2FA()" data-tr="Etkinleştir" data-de="Aktivieren">Etkinleştir</button>
            </div>
            <div class="security-item">
                <div class="security-info">
                    <h4 data-tr="Şifre Değiştir" data-de="Passwort ändern">Şifre Değiştir</h4>
                    <p data-tr="Güçlü bir şifre kullanın" data-de="Verwenden Sie ein starkes Passwort">Güçlü bir şifre kullanın</p>
                </div>
                <button class="security-action" onclick="changePassword()" data-tr="Değiştir" data-de="Ändern">Değiştir</button>
            </div>
            <div class="security-item">
                <div class="security-info">
                    <h4 data-tr="Oturum Geçmişi" data-de="Sitzungsverlauf">Oturum Geçmişi</h4>
                    <p data-tr="Son giriş aktivitelerini görüntüle" data-de="Letzte Anmeldeaktivitäten anzeigen">Son giriş aktivitelerini görüntüle</p>
                </div>
                <button class="security-action" onclick="viewSessions()" data-tr="Görüntüle" data-de="Anzeigen">Görüntüle</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function() {
    'use strict';

    function getCurrentLang() { return localStorage.getItem('selectedLang') || 'tr'; }

    function showNotification(message, type) {
        const toast = document.createElement('div');
        toast.style.cssText = 'position:fixed;top:20px;right:20px;padding:15px 25px;border-radius:10px;color:white;font-weight:500;z-index:9999;box-shadow:0 4px 20px rgba(0,0,0,0.2);animation:slideIn 0.3s ease;';
        toast.style.background = type === 'success' ? 'linear-gradient(135deg, #4CAF50, #45a049)' : type === 'error' ? 'linear-gradient(135deg, #f44336, #d32f2f)' : 'linear-gradient(135deg, #2196F3, #1976D2)';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(function() { toast.remove(); }, 3000);
    }

    // Checkbox toggle styling
    document.querySelectorAll('.checkbox-item input').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            if (this.checked) {
                this.closest('.checkbox-item').classList.add('checked');
            } else {
                this.closest('.checkbox-item').classList.remove('checked');
            }
        });
    });

    window.saveGeneral = function(e) {
        e.preventDefault();
        showNotification(getCurrentLang() === 'de' ? 'Allgemeine Einstellungen gespeichert!' : 'Genel ayarlar kaydedildi!', 'success');
    };

    window.saveHours = function(e) {
        e.preventDefault();
        showNotification(getCurrentLang() === 'de' ? 'Arbeitszeiten gespeichert!' : 'Çalışma saatleri kaydedildi!', 'success');
    };

    window.saveBilling = function(e) {
        e.preventDefault();
        showNotification(getCurrentLang() === 'de' ? 'Rechnungsinformationen gespeichert!' : 'Fatura bilgileri kaydedildi!', 'success');
    };

    window.saveBrand = function(e) {
        e.preventDefault();
        showNotification(getCurrentLang() === 'de' ? 'Markeneinstellungen gespeichert!' : 'Marka ayarları kaydedildi!', 'success');
    };

    window.handleLogoUpload = function(input) {
        if (input.files && input.files[0]) {
            document.getElementById('logoFileName').textContent = input.files[0].name;
            showNotification(getCurrentLang() === 'de' ? 'Logo ausgewählt' : 'Logo seçildi', 'success');
        }
    };

    window.toggleNotification = function(type, enabled) {
        const status = enabled ? 
            (getCurrentLang() === 'de' ? 'aktiviert' : 'etkinleştirildi') : 
            (getCurrentLang() === 'de' ? 'deaktiviert' : 'devre dışı bırakıldı');
        showNotification(type.toUpperCase() + ' ' + (getCurrentLang() === 'de' ? 'Benachrichtigungen' : 'bildirimleri') + ' ' + status, 'success');
    };

    window.setup2FA = function() {
        showNotification(getCurrentLang() === 'de' ? '2FA-Setup wird gestartet...' : '2FA kurulumu başlatılıyor...', 'info');
    };

    window.changePassword = function() {
        showNotification(getCurrentLang() === 'de' ? 'Passwort-Dialog wird geöffnet...' : 'Şifre değiştirme açılıyor...', 'info');
    };

    window.viewSessions = function() {
        showNotification(getCurrentLang() === 'de' ? 'Sitzungen werden geladen...' : 'Oturumlar yükleniyor...', 'info');
    };

    const style = document.createElement('style');
    style.textContent = '@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}';
    document.head.appendChild(style);
})();
</script>
{% endblock %}
